<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>@ViewBag.Title - My ASP.NET MVC Application</title>
    <link href="~/favicon.ico" rel="shortcut icon" type="image/x-icon" />
    <meta name="viewport" content="width=device-width" />
 
    @Scripts.Render("~/bundles/modernizr")
    @Styles.Render("~/Content/themes/base/css")
    <script src="~/Content/Scripts/jquery-1.9.1.js"></script>
    <script src="~/Scripts/Global.js"></script>
    <script type="text/javascript">
        var UserProfile;
    </script>
</head>
<body ng-app="mainModule">
     @if (@User.Identity.IsAuthenticated)
     {
         <link href="~/Content/Styles/Common.css" rel="stylesheet" />
        <div id="authinticated">
            @Html.AntiForgeryToken()
        </div>
         <script type="text/javascript">   
             UserProfile = { Name: '@User.Identity.Name' };
             Global.AjaxCall('/Api/User/PostUserInfo', null, function (response) {
                 UserProfile = response;
             });
             </script>
         
         
             <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.0.3.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--SignalR script to update the chat page and send messages.--> 
    <script>
        $(function () {

            var connection = $.hubConnection();
            //var contosoChatHubProxy = connection.createHubProxy('chatHub');
            //contosoChatHubProxy.on('addNewMessageToPage', function (name, message) {
            //    // Add the message to the page. 
            //    $('#discussion').append('<li><strong>' + htmlEncode(name)
            //        + '</strong>: ' + htmlEncode(message) + '</li>');
            //});

            var contosoChatHubProxy2 = connection.createHubProxy('Request');
            contosoChatHubProxy2.on('addNewMessageToPage', function (request,message) {
                //alert('request');
                $('.divNotificationPopup .divNotificationPopupText .pPersonActionText').html(message);
                $('.divNotificationPopup').show();
                setTimeout(function () { $('.divNotificationPopup').hide(); }, 5000);

            });

            //contosoChatHubProxy2.on('notifyMessageSent', function (message) {
            //    // Add the message to the page. 
            //    $('#discussion2').append('<li><strong>' + htmlEncode('send')
            //        + '</strong>: ' + htmlEncode(message) + '</li>');
            //});



            connection.start()
            .done(function () {

                //$('#sendmessage').click(function () {
                //    contosoChatHubProxy.invoke('send', $('#displayname').val(), $('#message').val() + connection.id).done(function () {
                //        console.log('Invocation of NewContosoChatMessage succeeded');
                //        $('#message').val('').focus();
                //    }).fail(function (error) {
                //        console.log('Invocation of NewContosoChatMessage failed. Error: ' + error);
                //    });

                //    console.log('Now connected, connection ID=' + connection.id);
                //    //alert($.connection.hub.id);
                //});

                var identity = "@(((Forum.Code.CustomPrincipal)HttpContext.Current.User).CustomIdentity.UserId)";

                contosoChatHubProxy2.invoke('send', identity, connection.id).done(function () {
                }).fail(function (error) {
                    console.log('Invocation of NewContosoChatMessage failed. Error: ' + error);
                });


            })
                .fail(function () { console.log('Could not connect'); });

        });

    </script>
     
     }
    <div id="userSettings" ng-controller="userSettingController">
        <div ng-include="userSettingPartial">

        </div>
    </div>

    <div id="body" ng-controller="homeController">
        <div>
            @RenderBody()
        </div>
    </div>

    <footer ng-controller="footerController">
        <div ng-include="footerPartial">

        </div>
    </footer>

    
    @*@Scripts.Render("~/bundles/jquery")*@
    @Scripts.Render("~/bundles/jqueryui")
    @Scripts.Render("~/bundles/ajaxlogin")
    @RenderSection("scripts", required: false)
   

        
    <script>
        //var model = that.GetEditGetWayData();
        //console.log(model);

        //Global.CallService("Post", '/Api/User/PostBasicInfo', null, 'application/json;charset=utf-8', 'json', true, function (response) {

        //}, function (msg) {
        //    alert(msg.responseText);
        //    //Global.Free();
        //});

        // for get user data
        //Global.AjaxCall('/Api/User/PostBasicInfo', null, function (response) {
        //    console.log(response);
        //});


        //var userUpdate = { Name: "new name", Location: "Dhaka", DoB: "1988-09-12" }

        //// for edit user data
        //Global.AjaxCall('/Api/User/PostEditBasicInfo', JSON.stringify(userUpdate), function (response) {
        //    console.log(response);
        //});

        //var no = { Text: "dfsf" }
        //Global.AjaxCall('/Api/UserPost/PostStatus', JSON.stringify(no), function (response) {
        //    console.log(response);
        //});

        
        //var search = { Name: "5388c82b1d10241bb00e8a58" }

        //// for edit user data
        //Global.AjaxCall('/Api/User/PostCancelRequest', JSON.stringify(search), function (response) {
        //    console.log(response);
        //});
        
</script>


@*<div class="container">
    <input type="text" id="message" />
    <input type="button" id="sendmessage" value="Send" />
    <input type="hidden" id="displayname" />
    <ul id="discussion">
    </ul>
</div>

<div class="container2">
    <input type="text" id="message2" />
    <input type="button" id="sendmessage2" value="Send" />
    <input type="hidden" id="displayname2" />
    <ul id="discussion2">
    </ul>
</div>*@



<div class="divNotificationPopup" style="display:none">
    <div class="divNotificationPopupText">
        <label class="pPersonActionText">Likes your photo Likes your photo Likes your photo Likes your photo Likes your photo</label>
    </div>
</div>


</body>
</html>